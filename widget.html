<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Portfolio Chat Widget</title>
<style>
  :root { --brand:#2563eb; --brand-100:rgb(210,227,255); --brand-200:rgb(190,215,255); }
  html,body { height:100%; margin:0; background:transparent; }
  body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrapper { position:fixed; right:0; bottom:0; width:360px; height:520px; }
  .launcher {
    position:absolute; right:16px; bottom:16px; width:64px; height:64px; border-radius:9999px;
    background:var(--brand); color:#fff; border:0; box-shadow:0 10px 20px rgba(0,0,0,.15);
    cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:3;
  }
  .panel {
    position:absolute; right:16px; bottom:96px; width:360px; height:480px; display:none; flex-direction:column;
    background:#fff; color:#111; border-radius:16px; box-shadow:0 20px 50px rgba(0,0,0,.2);
    border:1px solid #eee; overflow:hidden; z-index:2;
  }
  .panel.open { display:flex; }
  .header { padding:12px 16px; color:#fff; background:var(--brand); font-weight:600; font-size:14px; }
  .log { flex:1; padding:16px; overflow-y:auto; display:flex; flex-direction:column; gap:12px; }
  .row { display:flex; }
  .row.user { justify-content:flex-end; }
  .bubble { display:inline-block; max-width:75%; padding:8px 10px; border-radius:16px; white-space:pre-wrap; font-size:13px; color:#111; }
  .bubble.user { background:var(--brand-100); }
  .bubble.assistant, .bubble.system { background:var(--brand-200); }
  .suggestions { margin-top:6px; display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
  .sugg { background:#fff; border:1px solid #e5e7eb; border-radius:999px; padding:8px 12px; font-size:13px; color:#111; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.04); }
  .sugg:hover { box-shadow:0 2px 6px rgba(0,0,0,.08); }
  .input { padding:10px 12px; border-top:1px solid #eee; }
  .inputRow { display:flex; gap:8px; }
  .text { flex:1; border:1px solid #d1d5db; border-radius:8px; padding:10px 12px; font-size:14px; }
  .send { border-radius:8px; padding:10px 12px; border:0; color:#fff; background:var(--brand); cursor:pointer; }
  .footer { text-align:center; padding:10px; font-size:12px; color:#6b7280; border-top:1px solid #eee; }
  .footer a { color:var(--brand); text-decoration:underline; }
</style>
</head>
<body>
  <div class="wrapper" role="application" aria-label="Portfolio chat widget">
    <button class="launcher" aria-label="Open chat" title="Open chat">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M7 8h10M7 12h7" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
        <path d="M21 12a8.996 8.996 0 0 1-13.18 7.79L3 21l1.21-4.82A9 9 0 1 1 21 12Z"
              stroke="currentColor" stroke-width="2" fill="currentColor" fill-opacity=".08"></path>
      </svg>
    </button>

    <div class="panel" role="dialog" aria-label="Chat panel" aria-live="polite">
      <div class="header">Chat with me</div>
      <div class="log"></div>

      <div class="input">
        <div class="inputRow">
          <input class="text" type="text" placeholder="Ask about projects, skills, resume...">
          <button class="send">Send</button>
        </div>
      </div>

      <div class="footer">
        Still have questions? <a href="#" id="mailto">Email me</a>
      </div>
    </div>
  </div>

<script>

(function () {
  // ======= CONFIG（我的信息）=======
  var BRAND = "#2563eb";
  var TITLE = "What are you interested in?";
  var EMAIL = "loricai1017@gmail.com";
  var SUGGESTIONS = ["About me","Projects","Skills","Resume","Contact"];
  var FAQS = [
    {question:"About me",answer:"Hi! I'm Lori Cai, a product designer."},
    {question:"Projects",answer:"Realtime dashboard, visual diff tool, ML-aided search."},
    {question:"Skills",answer:"TypeScript, React/Next.js, Node, Python, Postgres, AWS."},
    {question:"Resume",answer:"Ask me for a link or grab it from the top nav."},
    {question:"Contact",answer:"Email me at "+EMAIL+" — I reply within 24h."}
  ];
=

  // set brand color
  document.documentElement.style.setProperty("--brand", BRAND);

  function norm(s){ return String(s||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").trim(); }
  function scoreMatch(q,t){
    if(!q) return 0; var a=norm(q), b=norm(t);
    if(a===b) return 3; if(b.indexOf(a)===0) return 2; if(b.indexOf(a)>-1) return 1; return 0;
  }

  var launcher=document.querySelector(".launcher");
  var panel=document.querySelector(".panel");
  var log=document.querySelector(".log");
  var input=document.querySelector(".text");
  var send=document.querySelector(".send");
  var mail=document.getElementById("mailto"); mail.href="mailto:"+EMAIL;

  var messages=[{role:"system",content:TITLE}];

  function append(role,content,showSuggs){
    var row=document.createElement("div"); row.className="row "+role;
    var bubble=document.createElement("div"); bubble.className="bubble "+role; bubble.textContent=content;
    row.appendChild(bubble); log.appendChild(row);

    if(showSuggs){
      var box=document.createElement("div"); box.className="suggestions";
      (SUGGESTIONS||[]).forEach(function(s){
        var b=document.createElement("button"); b.className="sugg"; b.title="Ask: "+s; b.textContent=s;
        b.addEventListener("click",function(){ handleUser(s); });
        box.appendChild(b);
      });
      log.appendChild(box);
    }
    log.scrollTop = log.scrollHeight;
  }

  function bestAnswer(q){
    var best=null;
    (FAQS||[]).forEach(function(qa){
      var s=scoreMatch(q,qa.question);
      if(s>0 && (!best || s>best.s || (s===best.s && qa.question.length>best.qa.question.length))) best={qa:qa,s:s};
    });
    return best?best.qa.answer:null;
  }

  function handleUser(text){
    var content=String(text||"").trim();
    if(!content) return;
    messages.push({role:"user",content:content});

    var reply=bestAnswer(content);
    if(!reply){
      var top=(FAQS||[]).slice(0,3).map(function(x){return x.question;}).join(", ");
      reply = (FAQS && FAQS.length)
        ? "I couldn't find an exact match. Try one of the suggestions below, or ask about: "+top+"."
        : "I couldn't find that. Try rephrasing or add more detail.";
    }
    var qn=norm(content);
    if(qn.indexOf("email")>-1 || qn.indexOf("contact")>-1) reply += " You can email me at "+EMAIL+".";

    messages.push({role:"assistant",content:reply});
    messages.push({role:"system",content:"Anything else I can help with?"});
    render();
  }

  function render(){
    log.innerHTML = "";
    for (var i=0;i<messages.length;i++){
      var m=messages[i];
      append(m.role,m.content,(i===0 || (m.role==="system" && i!==0)));
    }
  }

  launcher.addEventListener("click",function(){
    var open=panel.classList.toggle("open");
    launcher.setAttribute("aria-expanded", String(open));
    if(open) setTimeout(function(){ input.focus(); }, 0);
  });
  send.addEventListener("click",function(){ handleUser(input.value); input.value=""; input.focus(); });
  input.addEventListener("keydown",function(e){ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send.click(); } });

  render();
})();
</script>
</body>
</html>

